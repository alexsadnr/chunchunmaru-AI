# chunchunmaru-AI

Проект финального задания курса «Научная студия». Задача — предсказать состояние света на кухне (`Light_Kitchen`, 0/1) в «умном доме» по телеметрии сенсоров с шагом 1 секунда.

## Основная идея
- Используем первые 8 дней (`train_data.csv`) для обучения и валидации, 9-й день (`test_data.csv`) — для финальных предсказаний. Перед созданием признаков объединяем train+test, чтобы лаги корректно переходили через границу 8→9-го дня.
- Признаки строятся с учётом временной структуры: календарные признаки из `timestamp`, лаги/скользящие средние по сенсорам и, главное, лаги `Light_Kitchen`. Все они используют только прошлую информацию, поэтому утечки нет. Чтобы модель не «забывала» об ошибках в будущем, лаги целевой слегка зашумляются при обучении (случайно флипается ~5% значений), и модель учится устойчиво работать с несовершенной историей.
- Валидация выполняется по времени: ранние наблюдения обучают модель, последние — валидируют. Качество оценивается в двух режимах: teacher forcing (идеальные лаги цели) и последовательный rollout, который имитирует тестовый день, когда прошлое состояние света неизвестно.
- Модель: табличная нейросеть в PyTorch (`TabularNet`) с весами классов и ранней остановкой; итоговый порог классификации настраивается по sequential-валидации.

## Структура репозитория
- `main.py` — основной скрипт. Выполняет EDA, фичеринжиниринг, обучение PyTorch-модели, последовательную валидацию и формирует `submission.csv`.
- `train_data.csv` и `test_data.csv` — исходные данные за 8 и 1 день соответственно.
- `submission.csv` — появляется после запуска `main.py` и содержит предсказанный `Light_Kitchen` для тестового дня.

## Требования
- Python 3.10+
- Библиотеки: `pandas`, `numpy`, `scikit-learn`, `torch`

Установка зависимостей (пример):
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install pandas numpy scikit-learn torch
```

## Как запустить
Скрипт предполагает, что CSV-файлы лежат в корне проекта. Запуск:
```bash
python3 main.py
```

Что делает скрипт:
1. Загружает `train_data.csv` и `test_data.csv`.
2. Печатает базовый EDA.
3. Объединяет данные, строит календарные признаки, лаги сенсоров и `Light_Kitchen`, обрабатывает пропуски только статистиками из обучающей части.
4. Делит строки по времени (80/20), масштабирует признаки и обучает PyTorch-сеть с ранней остановкой.
5. Считает метрики в режиме teacher forcing и в режиме последовательного rollout, подбирает оптимальный порог классификации.
6. Обучает финальную модель на всех доступных данных, проходит по тесту последовательно, используя собственные прошлые вероятности, и создаёт `submission.csv` вида:
   ```
   ID,Light_Kitchen
   0,0
   1,0
   ...
   ```

Пути к файлам можно переопределить:
```bash
python3 main.py --train-path ./train_data.csv --test-path ./test_data.csv --output-path ./submission.csv
```

## Примечания
- Все статистики (медианы, скейлеры) считаются строго по обучающим данным соответствующего этапа — утечки нет.
- Sequential rollout использует предсказанные вероятности `Light_Kitchen` для формирования лагов, поэтому тестовый пайплайн полностью совпадает с валидационным.
- Скрипт легко адаптировать: поменять список лагов, архитектуру сети или стратегию подбора порога.
